INSTALLATION
============

## Installation des paquets (Debian/Ubuntu)

sudo apt-get update
sudo apt-get upgrade
sudo apt-get install --yes apache2 libapache2-mod-php php php-mysql php-gd php-zip php-mcrypt php-curl php-cli memcached php-memcached mariadb-server unoconv composer

## Installation elasticsearch (la version des dépôts ne fonctionne pas en service, utilisation des recommandations d'installation du site officiel)

wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
echo "deb https://packages.elastic.co/elasticsearch/2.x/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list
sudo apt-get install elasticsearch default-jre
sudo /usr/share/elasticsearch/bin/plugin install analysis-phonetic
sudo /usr/share/elasticsearch/bin/plugin install delete-by-query
sudo systemctl daemon-reload
sudo systemctl enable elasticsearch
sudo systemctl restart elasticsearch

## Attention lors d'un update de elasticsearch, il peut être nécessaire de mettre à jour les plugins !!

sudo /usr/share/elasticsearch/bin/plugin remove license
sudo /usr/share/elasticsearch/bin/plugin remove analysis-phonetic
sudo /usr/share/elasticsearch/bin/plugin remove delete-by-query

sudo /usr/share/elasticsearch/bin/plugin install license
sudo /usr/share/elasticsearch/bin/plugin install analysis-phonetic
sudo /usr/share/elasticsearch/bin/plugin install delete-by-query


## Activation des modules Apache

sudo a2enmod rewrite expires headers
sudo systemctl restart apache2

## Paramétrage MariaDB

sudo mysql -e "GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY 'root' WITH GRANT OPTION;"


## Installation de Ploopi et ses dépendances via composer

composer require ovensia/ploopi

## Outils optionnels pour l'extraction des contenus (utilisés par le module de gestion de documents)

sudo apt-get install python-hachoir-metadata catdoc xpdf-utils jhead unrtf unzip zip


## Test elasticsearch
curl -X GET 'http://localhost:9200'
curl 'http://localhost:9200/?pretty'
sudo /usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head
http://localhost:9200/_plugin/head/



## Configuration Apache

1. Activation des modules

sudo a2enmod rewrite expires headers

2. Création d'un Virtual Host (optionnel mais recommandé).

sudo nano /etc/apache2/sites-available/ploopi

Puis insérez les lignes suivantes :

<VirtualHost *>
        ServerName ploopi

        DocumentRoot /var/www/ploopi/

        <Directory /var/www/ploopi/>
                AllowOverride All
        </Directory>
</VirtualHost>


sudo a2ensite ploopi
sudo /etc/init.d/apache2 restart


wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
echo "deb https://packages.elastic.co/elasticsearch/2.x/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list
sudo apt-get install elasticsearch

sudo systemctl daemon-reload
sudo systemctl enable elasticsearch.service
sudo systemctl restart elasticsearch.service
systemctl status elasticsearch.service
#sudo journalctl -f

sudo apt-get install memcached php-memcached
sudo service apache2 restart
