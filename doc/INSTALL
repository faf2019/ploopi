P R E R E Q U I S
- - - - - - - - -

Installation des paquets

sudo apt-get install --yes --force-yes apache2 mysql-server php php-mysql php-gd php-zip php-mcrypt php-cli php-pear composer


Mise à jour de PEAR

sudo pear channel-update pear.php.net
sudo pear channel-discover pear.horde.org
sudo pear channel-update pear.horde.org

sudo pear install --alldeps PEAR_info Cache_Lite HTTP_Request2 horde/Horde_Text_Diff-2.0.1 XML_Serializer-0.20.2
sudo pear upgrade-all

Installation des composants via composer (à la racine du portail)
composer update


Vous pouvez très facilement installer les paquets prérequis pour un bon fonctionnement de PLOOPI sous Debian (en root) :

# Mise à jour de la liste des paquets
sudo apt-get update

# Installation des paquets
sudo apt-get install --yes --force-yes apache2 mysql-server php5 php5-mysql php5-gd php5-cli php5-mcrypt php5-xcache php-pear php5-dev make unoconv openoffice.org-writer



# Installation des librairies
sudo pear install --alldeps PEAR_info Cache_Lite HTTP_Request2 Net_UserAgent_Detect Text_Highlighter-0.7.3 horde/Horde_Text_Diff-2.0.1 XML_Serializer-0.20.2

# Mise à jour de PECL
sudo pecl channel-update pecl.php.net

# Installation de la librairie stem
# Répondez par « yes » à l'ensemble des questions
sudo pecl install stem

# Outils pour l'extraction des contenus (utilisés par le module de gestion de documents)
sudo apt-get install catdoc xpdf-utils jhead unrtf unzip zip

P A R A M E T R A G E   S E R V E U R
- - - - - - - - - - - - - - - - - - -

PHP
---
# Activation Stem
sudo echo "extension=stem.so" > /etc/php5/conf.d/stem.ini

# Modifications dans php.ini (sudo nano /etc/php5/apache2/php.ini)
date.timezone = Europe/Paris
output_buffering = Off
memory_limit = 128M
post_max_size = 32M
upload_max_filesize = 32M
error_log = syslog
expose_php = Off

Apache
------

1. Activation des modules

sudo a2enmod rewrite expires headers

2. Création d'un Virtual Host (optionnel mais recommandé).

sudo nano /etc/apache2/sites-available/ploopi

Puis insérez les lignes suivantes :

<VirtualHost *>
        ServerName ploopi

        DocumentRoot /var/www/ploopi/

        <Directory /var/www/ploopi/>
                AllowOverride All
        </Directory>

        # config CGI
        ScriptAlias /cgi/ /var/www/ploopi/cgi/
        <Directory "/var/www/ploopi/cgi/">
                AllowOverride None
                Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
                Order allow,deny
                Allow from all
        </Directory>
</VirtualHost>

# La configuration CGI permet d'uploader des fichiers sans limite de taille avec une barre de progression.
# Il est par contre nécessaire de disposer de l'interpréteur php en ligne de commande (paquet php5-cli)

# Pour terminer, il faut activer le virtualhost et recharger la configuration d'Apache :

sudo a2ensite ploopi
sudo /etc/init.d/apache2 restart

I N S T A L L A T I O N
- - - - - - - - - - - -

Méthode 1 (recommandée) : téléchargement d'une archive
------------------------------------------------------

1. Téléchargez la dernière version stable de Ploopi

wget http://download.ploopi.org/daily/ploopi_stable.tar.bz2

1b. ou la dernière version de développement

wget http://download.ploopi.org/daily/ploopi_dev.tar.bz2

2. Copiez le contenu de l'archive (en général un fichier .tar.bz2) sur votre serveur web :

tar jxvf ploopi_stable.tar.bz2

Méthode 2 (testeurs) : téléchargement depuis Subversion
-------------------------------------------------------

1. Si vous n'avez pas le client svn

sudo apt-get install subversion

2. Puis utilisez svn pour télécharger la dernière version :

svn export http://svn.ploopi.org/trunk /var/www/ploopi --force

3. Enfin, renommez le fichier .htaccess_modele en .htaccess

mv /var/www/ploopi/.htaccess_modele /var/www/ploopi/.htaccess

Suite et fin...
---------------

On supposera pour la suite que le dossier précédemment créé se situe dans /var/www/ploopi/

3. Configurez votre serveur web pour qu'il puisse accéder au dossier nouvellement créé (nous parlerons de http://mondomaine/ploopi/)

4. Vérifiez les droits d'accès en lecture/écriture pour le processus apache. L'idéal est d'appliquer les règles suivantes (en root) :

cd /var/www/ploopi/

sudo chown -R www-data:www-data .
sudo find . -type d -print0 | xargs -0 -n 1 chmod 500
sudo find . -type f -print0 | xargs -0 -n 1 chmod 400
sudo find {data,config,modules} -type d -print0 | xargs -0 -n 1 chmod 700
sudo find {data,config,modules} -type f -print0 | xargs -0 -n 1 chmod 600
sudo find bin -type f -print0 | xargs -0 -n 1 chmod 500
sudo chmod 500 ./cgi/upload.cgi

4. Ouvrez un navigateur à l'adresse http://mondomaine/ploopi/ - Vous devriez arriver sur la page d'installation.

5. Lorsque l'installation est terminée, il est fortement recommandé de supprimer le fichier ./config/install.php et de modifier les droits d'écriture pour apache sur le dossier ./config

rm -rf ./config/install.php
find config -type d -print0 | xargs -0 -n 1 chmod 500
find config -type f -print0 | xargs -0 -n 1 chmod 400

C O N F I G U R A T I O N   . H T A C C E S S
- - - - - - - - - - - - - - - - - - - - - - -

Un fichier .htaccess est inclus à la racine de Ploopi.
Ce fichier peut ne pas être interprété par Apache.
Vérifiez pour cela que la directive AllowOverride n'est pas configurée à "None".

Il peut être nécessaire de d'adapter le fichier .htaccess à votre configuration.
Notamment la directive RewriteBase qui doit être adapté au dossier contenant ploopi.
Si vous utilisez un virtual host vous pouvez laisser la configuration par défaut.

Si vous utilisez ploopi en sous dossier d'un site existant, indiquez le chemin relatif de ce dossier dans la directive RewriteBase.

RewriteBase /ploopi/
