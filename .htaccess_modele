# Attention, ce fichier est une configuration generique qu'il convient d'adapter a  votre environnement.
# Il existe des configurations plus solides que vous pouvez utiliser si vous pouvez directement modifier le fichier de configuration d'apache.

<IfModule mod_dir.c>
    DirectoryIndex index.html index.php
    Options +FollowSymLinks -Indexes
</IfModule>

<IfModule mod_php4.c>
    AddType application/x-httpd-php .php

    php_flag magic_quotes_gpc Off
    php_flag register_globals Off
    php_value include_path .
</IfModule>

<IfModule mod_php5.c>
    AddType application/x-httpd-php .php

    php_flag magic_quotes_gpc Off
    php_flag register_globals Off
    php_value include_path .
</IfModule>

<files *.svg.gz>
    AddType "image/svg+xml" .gz
    AddEncoding gzip .gz
</files>

<files *.js.gz>
    AddType "text/javascript" .gz
    AddEncoding gzip .gz
</files>

<files *.css.gz>
    AddType "text/css" .gz
    AddEncoding gzip .gz
</files>

<IfModule rewrite_module>
    RewriteEngine on

    # Changez cette valeur si PLOOPI est installe dans un sous dossier du site (ex : /test )
    RewriteBase /

    # Vérifie si le navigateur peut accepter les fichier gzip
    ReWriteCond %{HTTP:accept-encoding} gzip
    RewriteCond %{HTTP_USER_AGENT} !Safari
    # make sure there's no trailing .gz on the url
    ReWriteCond %{REQUEST_FILENAME} !^.+\.gz$
    # Vérifie si une version .gz du fichier existe
    RewriteCond %{REQUEST_FILENAME}.gz -f
    # Si toutes les conditions sont remplies on ajoute .gz à l'url du fichier (de manière transparente)
    RewriteRule ^(.+) $1.gz [QSA,L]

    # Quelques restrictions d'acces
    RewriteRule ^modules/.*\.php$ - [F]
    RewriteRule ^lib/.*\.php$ - [F]
    RewriteRule ^FCKeditor/.*\.php$ - [F]
    RewriteRule ^(bin/|data/|db/|include/|install/|pear/)(.*)$ - [F]

    # Regles de reecriture pour la partie FrontOffice
    RewriteRule ^(.*)-h([0-9]*)a([0-9]*)\.[a-z0-9]*(.*)$ index.php?headingid=$2&articleid=$3$4 [L]
    RewriteRule ^(.*)-h([0-9]*)\.[a-zA-Z0-9]*(.*)$ index.php?headingid=$2$3 [L]
    RewriteRule ^(.*)-a([0-9]*)\.[a-zA-Z0-9]*(.*)$ index.php?articleid=$2$3 [L]
    RewriteRule ^tag-([a-zA-Z0-9]*)\.[a-zA-Z0-9]*(.*)$ index.php?query_tag=$1$2 [L]
    RewriteRule ^(.*)-d([a-z0-9]{32})\.[a-zA-Z0-9]*(.*)$ index-quick.php?ploopi_op=doc_file_download&docfile_md5id=$2 [L]
</IfModule>

